# BeDAO 管理后台系统

## Overview
BeDAO 管理后台是一个基于 Next.js 15 和 React 构建的专业加密货币交易平台后台管理系统。其核心目的是为平台运营人员提供全面的管理功能，包括用户管理、交易监控、财务管理和系统配置，以确保加密货币交易平台的顺畅运行和资产安全。该系统专注于后台管理功能，不包含任何面向用户的客户端功能。

## User Preferences
Preferred communication style: Simple, everyday Chinese language.

## System Architecture

### UI/UX Decisions
- **导航架构**: 采用顶部导航栏（20个一级模块菜单）与左侧边栏（动态二级子菜单）的双层导航体系。顶部一级菜单顺序：权限、财务、报表、审核、运营、用户、Crypto、法币、佣金、现货、合约、跟单、期权、C2C、担保、理财、U卡、社交、IM、运维。
- **财务模块**: Crypto资产管理和法币资产管理已从各自的业务模块（Crypto/法币）移至财务模块（orders），路径分别为 `/admin/orders/crypto-assets` 和 `/admin/orders/fiat-assets`，确保点击时一级菜单保持在财务模块。
- **响应式设计**: 支持桌面端横向滚动菜单和移动端汉堡菜单侧边Sheet弹窗。
- **主题**: 支持动态亮色/暗色主题切换，并持久化用户偏好。
- **品牌与配色**: 统一的BeDAO品牌设计，采用绿色、黑色、深蓝色、白色作为标准化配色方案。
- **登录页面**: 独立的登录页面布局。提供账号密码登录、邮箱验证码验证功能。支持首次登录时绑定谷歌验证码（Google Authenticator），通过扫描二维码或手动输入密钥完成绑定。
- **个人中心**: 登录后默认进入个人中心页面（/admin/profile），提供个人信息展示、登录记录查看、安全设置（修改密码、重置Google验证码）等功能，布局仅包含顶部导航（无左侧边栏）。退出登录按钮位于个人信息卡片下方。
- **报表模块（operations）**: 独立的报表模块，包含8个子页面：运营报表（/admin/operations/dashboard）、运营活动（/admin/operations/activities）、审核监控（/admin/operations/audit）、资金流水（/admin/operations/funds）、订单监控（/admin/operations/orders）、留存分析（/admin/operations/retention）、风控预警（/admin/operations/risk）、行情配置（/admin/operations/market-config）。点击顶部导航"报表"时，左侧边栏显示这些页面的平级菜单。
- **运营模块（marketing）**: 包含35个子页面，采用**两级菜单分类结构**，分为5个功能分组：
  - 【用户管理】：注册白名单、KYC限额管理、现货费率管理
  - 【运营配置】：WEB注册页广告、国家/地区管理、2FA场景配置、提示语配置、金刚区管理、官方渠道配置、广告位管理、榜单配置、首页弹窗、Push通知、Banner管理、站内配置
  - 【内容管理】：邮件内容、邮件发送、荣誉管理、日程安排管理、语音发料、消息发送、创建邮件
  - 【运营活动】：抵扣金明细、体验金明细、用户抵扣金、用户体验金、卡券配置
  - 【运维管理】：权限管理、角色管理、用户管理、审核配置、APP管理、运维管理、维护计划配置、维护白名单管理（路径保持为/admin/system/*）
  - 左侧边栏显示分组标题（不再使用【】符号）和对应的二级菜单项。点击顶部导航"运营"按钮时，左侧边栏显示所有5个分组的完整菜单。
- **功能优化**:
    - **通道管理**: 提供通道配置和费率管理，支持两级页签筛选、右侧滑出弹窗进行添加/编辑、Inline编辑通道名称、外显名称及费率数据，并支持状态快速开关。
    - **接口管理**: 采用紧凑卡片设计展示支付接口，支持Inline编辑接口名称和描述、状态快速开关、停用视觉反馈，以及通过右侧滑出面板进行供应商配置。
    - **代理商管理**: 重构佣金管理为代理商管理，提供启用/冻结开关、佣金比例查看等。
    - **法币用户管理**: 提供多种筛选、账户余额详情、密钥管理、域名审核及精细化费率配置。
    - **订单管理**: 涵盖代收、代付、兑换订单管理，支持信息查看、补发通知、冻结/退款等操作。
    - **Crypto模块**: 包含经营报表（顶部8个统计卡片展示链上充值/提现、净流入、活跃钱包、手续费收益、Gas成本、净利润、OTC交易量，支持时间范围筛选：今天/昨天/最近7天/最近30天/自定义，支持CSV导出，所有金额使用USDT单位）、币种管理（支持两级页签筛选：一级按分类筛选全部/稳定币/主流币/MEME币，二级按网络类型动态筛选）、地址管理（供应商页签在右上角，类型/网络页签层级展示，搜索行包含状态页签+币种筛选+搜索框）、供应商接口（原托管钱包接口）、Crypto出入金订单（统一管理入金和出金订单，通过tabs切换，支持类型感知的统计卡片、状态筛选和表格列，地址分三列显示：来源地址、充值/目标地址、交易哈希按钮，地址显示为前8位...后8位格式，支持悬停复制）、**Crypto用户管理**（完整复刻法币用户管理页面结构，包含4个互斥页签：普通用户/API商户/正在申请API/全部用户，展示用户信息/联系方式/多币种余额（USDT/BTC/ETH/USDC/TRX）/利润贡献/交易量/API密钥/状态/操作等完整表格列，支持余额明细、利润分析（今日/昨日/本月/累计）、交易量分析、费率配置管理、API密钥审批、冻结资金、编辑/删除等全面功能，所有币种数据覆盖USDT/BTC/TRX/ETH/USDC，网络包含TRC20/ERC20/BSC/Polygon/Solana/Arbitrum，普通用户密钥列显示"无API"灰色文本不可点击）、OTC供应商、OTC订单等子模块。二级菜单顺序：经营报表 → Crypto用户管理 → 币种管理 → 地址管理 → 供应商接口 → Crypto出入金订单 → OTC供应商 → OTC订单。支持卡片式展示、状态开关、权重分配、链式过滤逻辑（搜索→分类→子分类）及订单统计。币种管理提供Inline编辑功能（logo上传、最小提现、提现手续费、排序）和右侧滑出Sheet添加新币种。经营报表页面包含每日/每月报表表格视图，可展开查看利润前10币种、利润前10网络和成交前10 OTC供应商详情。**注意**：Crypto资产管理已移至财务模块。
    - **财务模块（orders）**: 包含Crypto资产管理（原Crypto模块的资产统计，展示热/冷钱包资产、二级页签筛选、分页加载等功能，路径：`/admin/orders/crypto-assets`）、法币资产管理（原法币模块的资产统计，包含顶部4个统计卡片、法币币种列表、划款记录Sheet弹窗、划款操作Dialog弹窗等功能，路径：`/admin/orders/fiat-assets`）以及其他订单相关功能。
    - **U卡管理**: 包含U卡用户、供应商、基础配置、号段、开卡/充值/消费记录、用户资产变化及列表等全面管理功能，支持表格/卡片式布局、状态管理、筛选、搜索及配置。
    - **C2C模块**: 包含C2C管理、C2C订单、法币快捷配置、法币快捷订单、OTC配置、OTC订单等子页面。
    - **法币模块**: 包含经营报表（顶部8个统计卡片展示用户统计、今日/昨日业务、下发统计、资金统计、今日/昨日/本月利润分解，支持时间范围筛选：今天/昨天/最近7天/最近30天/自定义，支持CSV导出，所有金额使用USDT单位）、法币用户管理（提供4个互斥页签：普通用户/API商户/正在申请API/全部用户，支持多种筛选、账户余额详情、密钥管理、域名审核及精细化费率配置，普通用户密钥列显示"无API"灰色文本不可点击）、币种管理、供应商管理、接口管理、通道管理、代理商管理、代收订单、代付订单、兑换订单等子模块。二级菜单顺序：经营报表 → 法币用户管理 → 币种管理 → 供应商管理 → 接口管理 → 通道管理 → 代理商管理 → 代收订单 → 代付订单 → 兑换订单。经营报表页面包含每日/每月报表表格视图，可展开查看利润前10支付渠道和利润前10用户详情。**注意**：法币资产管理已移至财务模块。
    - **佣金模块**: 包含支付佣金和U卡佣金两个子页面，统一采用推广员排行榜设计。顶部4个统计卡片：推广员总数、今日支出佣金、昨日支出佣金、本月支出佣金。一级页签筛选：佣金排名、交易量排名、推广下线数量排名，根据选择的排名类型动态调整表格列。二级页签筛选：法币币种（CNY/USD/EUR/JPY/KRW/THB/VND），支持实时金额换算。推广员排行榜列表展示排名（前三名使用渐变徽章：金/银/铜）、推广员信息、联系方式、累计佣金/交易量/下线数量、趋势指标等。支持加载更多功能和总计数显示（显示"推广员"标签）。路径：`/admin/commission/payment`（支付佣金）、`/admin/commission/ucard`（U卡佣金）。

### Technical Implementations
- **Frontend**: Next.js 15 (App Router), Tailwind CSS, shadcn/ui, React Context API for state management, Recharts, Lucide React, internationalization.
- **Backend**: Express.js with session management.
- **Database**: PostgreSQL with Drizzle ORM.
- **Authentication**: Replit Auth (OpenID Connect), independent admin login with email verification, PostgreSQL-backed session store.
- **Core Features**:
    - 综合性后台管理面板，包含16个管理模块。
    - 登录后访问控制和管理员认证状态持久化。
    - 客户端路由使用 `instant-navigation` 实现即时页面切换和加载动画。

### System Design Choices
- **客户端路由**: 采用 `instant-navigation` 组件和 `window.history.pushState`/`popstate` 实现即时页面切换，避免页面重载。
- **加载动画**: 页面切换时显示旋转加载器和“加载中...”文字。
- **状态管理**: 使用 React Context API 管理全局状态。
- **安全性**: 安全的会话处理和路由保护，未登录时自动跳转登录页。
- **部署**: 支持Next.js服务器功能和独立输出的自动扩展部署配置。
- **多级页签过滤系统**: 
  - **两级页签系统**（币种管理、法币买卖接口等）:
    - 采用嵌套shadcn Tabs组件实现两级筛选
    - 使用链式useMemo过滤（搜索→一级分类→二级分类）
    - 一级页签切换时自动重置二级页签选择
    - 二级页签选项根据一级分类动态生成（出入金币种）或固定预设（法币币种）
    - 数据模型扩展：Crypto币种添加category字段（stablecoin/mainstream/meme），法币币种添加region字段（asia/africa/americas/europe/other）
  - **三级页签系统**（OTC供应商）:
    - **一级页签**：位于页面标题行右侧（全部/买入/卖出）
    - **二级页签**：位于搜索区域上方（币种筛选：全部币种/USDT/BTC/ETH）
    - **三级页签**：位于搜索框同一行左侧（状态筛选：全部状态/正常/停用/暂停）
    - **搜索行布局**：状态页签 + 搜索框（flex-1）
    - 使用四级链式useMemo过滤（搜索 → 交易类型 → 币种 → 状态）
    - 级联重置：一级页签切换时重置二级+三级页签，二级页签切换时重置三级页签
    - 数据模型扩展：OTCSupplier添加currencies字段（string[]数组，默认["USDT","BTC","ETH"]）
    - 交易类型过滤：buy检查buyEnabled，sell检查sellEnabled
    - 币种过滤：支持空数组向后兼容或精确包含匹配
    - 已删除：状态下拉筛选框
  - **四级页签系统**（OTC订单）:
    - **一级页签**：位于页面标题行右侧（全部/买入/卖出）
    - **二级页签**：位于搜索区域上方（供应商筛选，根据一级页签动态生成）
    - **三级页签**：位于二级页签下方（币种筛选：全部币种/USDT/BTC/ETH）
    - **四级页签**：位于搜索框同一行左侧（状态筛选：全部状态/待支付/已支付/处理中/已完成/已取消/失败）
    - **搜索行布局**：状态页签 + 搜索框（flex-1）
    - 使用五级链式useMemo过滤（搜索 → 类型 → 供应商 → 币种 → 状态）
    - 级联重置：切换一级页签时自动重置二级页签为"全部"
    - 动态供应商列表：基于一级页签筛选结果生成可用供应商选项
    - 已删除：顶部统计卡片、币种下拉筛选框
  - 添加/编辑对话框包含完整字段选择确保TypeScript类型完整

## External Dependencies

### Core
- React 19
- Next.js 15
- Drizzle ORM
- Neon Database (for PostgreSQL)
- Express.js
- Passport.js

### UI and Styling
- Tailwind CSS
- Radix UI
- Recharts
- Lucide React
- shadcn/ui