# BeDAO 管理后台系统

## Overview
BeDAO 管理后台是一个基于 Next.js 15 和 React 构建的专业加密货币交易平台后台管理系统。其核心目的是为平台运营人员提供全面的管理功能，包括用户管理、交易监控、财务管理和系统配置，以确保加密货币交易平台的顺畅运行和资产安全。该系统专注于后台管理功能，不包含任何面向用户的客户端功能。

## User Preferences
Preferred communication style: Simple, everyday Chinese language.

## System Architecture

### UI/UX Decisions
- **导航架构**: 采用顶部导航栏（18个一级模块菜单）与左侧边栏（动态二级子菜单）的双层导航体系。
- **主题与品牌**: 支持动态亮色/暗色主题切换，并持久化用户偏好；统一的BeDAO品牌设计，采用绿色、黑色、深蓝色、白色作为标准化配色方案。
- **登录页面**: 独立的登录页面布局，提供账号密码登录、邮箱验证码验证，支持首次登录绑定谷歌验证码。
- **个人中心**: 登录后默认进入个人中心页面，提供个人信息展示、登录记录、安全设置等功能。
- **模块设计**: 审核和运营模块采用两级可折叠菜单分类结构。
- **功能优化**:
    - **通道管理**: 提供通道配置和费率管理，支持两级页签筛选、右侧滑出弹窗编辑、Inline编辑、状态快速开关。
    - **接口管理**: 采用紧凑卡片设计，支持Inline编辑、状态快速开关、供应商配置。
    - **代理商管理**: 重构佣金管理为代理商管理，提供启用/冻结开关、佣金比例查看。
    - **法币用户管理**: 提供筛选、账户余额详情、密钥管理、域名审核及精细化费率配置。
    - **订单管理**: 涵盖代收、代付、兑换订单管理，支持信息查看、补发通知、冻结/退款。
    - **Crypto模块**: 包含经营报表、币种管理、地址管理、供应商接口、Crypto出入金订单、Crypto用户管理、OTC供应商、OTC订单等子模块。Crypto用户管理完整复刻法币用户管理页面结构，包含多币种余额、利润分析、交易量分析、费率配置、API密钥审批等功能。
    - **权限管理模块**: 包含业务线、审核配置、人员管理、用户权限、系统管理、系统日志、手动开分（支持为用户充值或扣减资金，路径：`/admin/permissions/manual-credit`）、手动转账（支持用户间资金转移，路径：`/admin/permissions/manual-transfer`）、大额提币审核（支持大额提币订单的审核与拒绝，路径：`/admin/permissions/large-withdrawal-audit`）等共9个子页面。
    - **财务模块（orders）**: 包含财务经营报表（路径：`/admin/orders/business-overview`，展示各业务模块收入、成本、利润汇总）、Crypto资产管理（路径：`/admin/orders/crypto-assets`）、法币资产管理（路径：`/admin/orders/fiat-assets`）和U卡资产管理（路径：`/admin/orders/ucard-assets`，展示U卡总资产、供应商资产分布、卡片统计）四个子页面。点击顶部财务按钮默认打开财务经营报表。
    - **U卡管理**: 包含用户、供应商、基础配置、号段、开卡记录、U卡划转兑换（路径：`/admin/ucard/recharge-records`）、消费记录等功能。注：U卡账户划转记录已删除。
    - **C2C模块**: 包含C2C管理、C2C订单、法币快捷配置、法币快捷订单、OTC配置、OTC订单等子页面。
    - **法币模块**: 包含经营报表、法币用户管理、币种管理（支持inline编辑排序）、供应商管理、接口管理、通道管理、代理商管理、代收订单、代付订单、兑换订单等子模块。
    - **佣金模块**: 包含支付佣金和U卡佣金，采用推广员排行榜设计，支持多维度排名和法币币种筛选。

## Recent Changes

### 2025-11-27: U卡供应商页面重新设计
- **页面布局重构**: 采用可展开/折叠的供应商卡片列表设计，每个供应商展开后显示其提供的所有卡种
- **供应商信息展示**:
  - 供应商名称、Logo、状态标签
  - 汇总信息：卡种数量、启用卡种数、本月发卡、累计发卡
  - 号段信息按钮：显示号段数量和使用中数量，点击打开号段详情弹窗
  - 状态开关和设置按钮
- **卡种详情展示**（展开后显示）:
  - 卡种类型：虚拟卡（蓝色）、黑金实体卡（黑金色）、白金实体卡（银灰色）、标准实体卡（灰色）
  - 卡种名称、支持币种标签（USD绿色、EUR蓝色、GBP紫色等）
  - 本月开卡数、累计开卡数、开卡费用
  - 卡种状态（启用/停用）
- **号段查询弹窗**: 点击号段按钮打开弹窗，显示该供应商的所有号段
  - 统计信息：号段总数、使用中、总容量
  - 号段列表：号段名称、卡号范围、使用率进度条、状态标签
  - 状态标签：使用中（绿色）、已用完（红色）、保留中（灰色）
- **统计卡片**: 供应商总数、合作中、卡种总数、启用卡种、本月发卡、累计发卡
- **供应商详情弹窗**: 点击设置按钮打开侧边栏，显示基本信息、发卡统计、号段信息和所有卡种详情

### 2025-11-26: U卡模块新增实体卡寄送订单页面
- **新增实体卡寄送订单页面**: 路径 `/admin/ucard/shipping-orders`，管理实体卡的物流寄送
- **统计卡片**: 显示总订单、待处理、制卡中、运输中、已签收、已退回数量
- **订单列表展示**:
  - 订单信息（订单号、创建时间）
  - 用户信息（用户名、用户ID）
  - 卡片信息（卡片类型标签、卡号）
  - 收件信息（收件人、电话、地址）
  - 物流信息（快递公司、物流单号）
  - 状态标签（待处理灰色、制卡中黄色、已发货蓝色、运输中紫色、已签收绿色、已退回红色）
- **详情弹窗**: 展示完整的卡片信息、时间信息、收件信息、物流信息
- **卡片类型样式**: 黑金实体卡（黑色背景）、白金实体卡（渐变灰色）、标准实体卡（灰色）
- **侧边栏导航**: 已添加到U卡模块二级菜单，位于"U卡开卡记录"之后

### 2025-11-26: Crypto模块新增冻解记录页面
- **新增Crypto冻解记录页面**: 路径 `/admin/crypto/freeze-records`，记录所有Crypto资产的冻结和解冻操作
- **页面结构与法币冻解记录一致**:
  - 左侧页签筛选：冻结记录、解冻记录
  - 右侧检索：用户ID/用户名、订单号、操作管理员、时间筛选
  - 数据展示：订单号、用户信息、类型、币种、金额、余额变动、冻结变动、原因、操作员、时间
- **币种为加密货币**: 支持USDT、BTC、ETH、TRX、USDC等加密货币
- **币种标签样式**: 每种加密货币使用不同的颜色标识（BTC橙色、ETH紫色、USDT绿色、USDC蓝色、TRX红色）
- **侧边栏导航**: 已添加到Crypto模块二级菜单中

### 2025-11-26: Crypto用户管理冻结/解冻功能增强
- **操作列按钮**: 拆分为独立的"冻结资金"（橙色）和"解冻资金"（绿色）两个按钮
- **冻结资金弹窗**: 币种选择（USDT/BTC/ETH/TRX/USDC）、显示余额信息、冻结理由必填
- **解冻资金弹窗**: 币种选择、显示当前冻结金额、验证解冻金额不超限
- **账户余额弹窗**: 冻结金额支持inline编辑（点击编辑、Enter保存、Escape取消）

### 2025-11-25: 法币模块新增冻解记录页面
- **新增冻解记录页面**: 路径 `/admin/fiat/freeze-records`，记录所有冻结和解冻操作
- **左侧页签筛选**: 
  - 全部记录：显示所有冻结和解冻记录
  - 冻结记录：仅显示冻结操作
  - 解冻记录：仅显示解冻操作
- **右侧检索功能**: 
  - 用户ID/用户名检索
  - 订单号检索
  - 操作管理员检索
  - 时间日期筛选（今天/昨天/本周/本月）
- **数据展示**: 订单号、用户信息、类型、币种、金额、余额变动、冻结变动、原因、操作员、时间

### 2025-11-25: 法币用户管理冻结/解冻资金功能
- **操作列按钮优化**: 将原来的单一冻结按钮拆分为"冻结资金"和"解冻资金"两个独立按钮
- **冻结资金弹窗**: 
  - 支持选择币种（CNY/USD/USDT/EUR/GBP）
  - 选择币种后显示当前可用余额和已冻结金额
  - 输入冻结金额后将资金从可用余额转移到冻结余额
- **解冻资金弹窗**: 
  - 支持选择币种
  - 选择币种后显示当前冻结金额（醒目的橙色提示框）
  - 输入解冻金额后将资金从冻结余额释放到可用余额
  - 验证解冻金额不超过当前冻结金额
- **账户余额弹窗可编辑冻结金额**: 
  - 冻结金额列支持点击编辑（inline编辑模式）
  - 支持Enter保存、Escape取消
  - 修改后实时更新用户余额数据

### 2025-11-25: Crypto手续费配置弹窗
- **独立的Crypto手续费弹窗**: 在Crypto用户管理页面中，将原来的"用户通道配置"弹窗改为专门的"Crypto手续费配置"弹窗，不再复用法币用户管理的通道管理逻辑
- **新增数据结构**: 
  - `CryptoNetworkFee`: 定义每个网络的手续费配置（提币费率、提币费上限、最低提币费、地址月租费、免费地址数）
  - `CryptoFeeConfig`: 定义用户的Crypto手续费配置列表
  - `createDefaultCryptoFeeConfig`: 工厂函数，生成默认手续费配置
  - `defaultSystemCryptoFeeConfig`: 系统统一手续费配置
- **弹窗功能**: 
  - **双页签设计**: 顶部两个页签切换
    - 用户单独配置：为当前用户配置独立的手续费
    - 系统统一配置：配置所有启用"系统费率"用户的统一费率
  - 网络配置表格：按网络(TRC20/ERC20/BSC/Polygon/Solana)配置
  - 配置项：提币费率、提币费上限、最低提币费、地址月租费、免费地址数
  - 支持启用/禁用网络、使用系统费率开关
  - Inline编辑，实时更新状态
  - 用户启用"系统费率"后，对应网络的输入框自动禁用
- **UI设计**: 采用Sheet侧边栏弹窗，与页面既有风格保持一致

### 2025-11-15: 法币币种管理排序功能
- **币种管理排序**: 在法币币种管理页面添加了"排序"列，支持inline编辑排序值，点击数字即可进入编辑模式
- **排序功能特性**: 
  - 支持点击编辑、Enter保存、Escape取消
  - 新增币种自动分配下一个排序值
  - 列表自动按sortOrder升序排列
  - 编辑时预填充当前值，取消时正确清理状态
- **登录界面优化**: 删除了演示账号提示信息，提升专业性

### Technical Implementations
- **Frontend**: Next.js 15 (App Router), Tailwind CSS, shadcn/ui, React Context API, Recharts, Lucide React, internationalization。
- **Backend**: Express.js with session management。
- **Database**: PostgreSQL with Drizzle ORM。
- **Authentication**: Replit Auth (OpenID Connect), independent admin login with email verification, PostgreSQL-backed session store。
- **Core Features**: 综合性后台管理面板，包含16个管理模块；登录后访问控制和管理员认证状态持久化；客户端路由使用 `instant-navigation` 实现即时页面切换和加载动画。

### System Design Choices
- **客户端路由**: 采用 `instant-navigation` 实现即时页面切换，避免页面重载。
- **状态管理**: 使用 React Context API 管理全局状态。
- **安全性**: 安全的会话处理和路由保护，未登录时自动跳转登录页。
- **多级页签过滤系统**: 实现两级、三级、四级页签系统，支持链式过滤、级联重置和动态选项生成。

## External Dependencies

### Core
- React 19
- Next.js 15
- Drizzle ORM
- Neon Database (for PostgreSQL)
- Express.js
- Passport.js

### UI and Styling
- Tailwind CSS
- Radix UI
- Recharts
- Lucide React
- shadcn/ui